#!/usr/bin/env sh

echo "🔍 Ejecutando validaciones pre-commit..."

# Ejecutar linting
echo "📝 Verificando linting..."
npm run lint
if [ $? -ne 0 ]; then
    echo "❌ Linting falló. Corrige los errores antes de hacer commit."
    exit 1
fi

# Ejecutar tests
echo "🧪 Ejecutando tests..."
npm run test -- --coverage --ci
if [ $? -ne 0 ]; then
    echo "❌ Tests fallaron. Corrige los errores antes de hacer commit."
    exit 1
fi

# Ejecutar build
echo "🔨 Verificando build..."
npm run build
if [ $? -ne 0 ]; then
    echo "❌ Build falló. Corrige los errores antes de hacer commit."
    exit 1
fi

# Verificar vulnerabilidades
echo "🔒 Verificando vulnerabilidades de seguridad..."
npm audit --audit-level=high
if [ $? -ne 0 ]; then
    echo "❌ Se encontraron vulnerabilidades de seguridad. Ejecuta 'npm audit fix' antes de hacer commit."
    exit 1
fi

echo "✅ Todas las validaciones de código pasaron."
echo "📝 Ahora se validará el formato del mensaje de commit..."
